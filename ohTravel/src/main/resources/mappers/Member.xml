<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.oracle.ohTravel.Member">
	<!-- 로그인 -->
	<select id="login" parameterType="memberDTO" resultType="memberDTO">
		SELECT *
		FROM MEMBER
		WHERE mem_id = #{mem_id}
		AND mem_password = #{mem_password}
	</select>
	
	<!-- 회원가입 -->
	<insert id="register" parameterType="memberDTO">
		INSERT INTO MEMBER (
							mem_id,
							mem_name,
							mem_password,
							mem_email,
							mem_tel,
							mem_birthday,
							mem_create,
							mem_role	)
					VALUES(
							#{mem_id},
							#{mem_name},
							#{mem_password},
							#{mem_email},
							#{mem_tel},
							#{mem_birthday},
							now(),
							#{mem_role}	)
	</insert>
	
	<!-- 티켓 예약 내역 조회 -->
	<select id="ticketReservList" resultType="TicketReservationDTO" parameterType="TicketReservationDTO">
		SELECT * FROM ticket_reservation WHERE mem_id = #{mem_id}
	</select>
	
	<!-- 항공 예약 내역 조회 -->
	<select id="airReservList" resultType="AirReservationDTO" parameterType="AirReservationDTO">
		SELECT * FROM reservation WHERE mem_id = #{mem_id}
	</select>
	
	<!-- 호텔 예약 내역 조회 -->
	<select id="hotelReservList" resultType="HotelReservationDTO" parameterType="HotelReservationDTO">
		SELECT * FROM hotel_reservation WHERE mem_id = #{mem_id}
	</select>
	
	<!-- 패키지 예약 내역 조회 -->
	<select id="packageReservList" resultType="PackageReservationDTO" parameterType="PackageReservationDTO">
		SELECT * FROM package_reservation WHERE mem_id = #{mem_id}
	</select>
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	<!-- 회원 등급까지 가져오는 sql -->
	<select id="selectMemberWithGrade" parameterType="string" resultType="memberDTO">
		select 
		m.*, 
		m_ms.membership_id, m_ms.mem_mile,
		ms.membership_name, ms.membership_discount 
		from member m
		join mem_membership m_ms on m.mem_id = m_ms.mem_id
		join membership ms on m_ms.membership_id = ms.membership_id
		where m.mem_id = #{mem_id};
	</select>
	
	<!-- 회원이 가지고 있는 쿠폰 가져오기 sql - 사용 기한(coupon_limit_date) 가 지나지 않은 것만 -->
	<select id="selectMemberWithCoupon" parameterType="string" resultType="Coupon">
		select 
		m.mem_id, 
		mc.coupon_id, mc.coupon_down, mc.coupon_use, mc.coupon_limit_date,
		c.coupon_name, c.coupon_discount
		from member m
		join mem_coupon mc on m.mem_id = mc.mem_id
		join coupon c on mc.coupon_id = c.coupon_id
		where mc.mem_id = #{mem_id} and  mc.coupon_use = 0 and mc.coupon_limit_date >= now()
	</select>
</mapper>
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.oracle.ohTravel.Manager">
	<!-- ===================================================================================================================== -->
	<!-- 회원관리 - 회원/등급관련 -->

	<!-- 모든 맴버보기 -->
	<select id="MemberList" resultType="Member">
		SELECT * FROM member
	</select>
	<!-- 모든 등급 보기 -->
	<select id="MembershipList" resultType="Membership">
		SELECT * FROM membership
	</select>
	<!-- 맴버상세보기 조인된 컬럼까지 모두 -->
	<select id="GetUserDetail" parameterType="Membership" resultType="Membership">
		select m.*,mm.mem_mile,mm.membership_id,ms.membership_name from member m inner join mem_membership mm on m.mem_id=mm.mem_id inner join membership ms on mm.membership_id=ms.membership_id WHERE m.mem_id=#{mem_id}
	</select>
	<!-- 맴버한명의 권한 수정 -->
	<update id="UpdateUserRole" parameterType="Membership">
		UPDATE member SET mem_role = #{mem_role} WHERE mem_id=#{mem_id}
	</update>
	<!-- 맴버 한명의 등급변경 -->
	<update id="UpdateUserMemName" parameterType="Membership">
		UPDATE mem_membership SET membership_id = #{membership_id} WHERE mem_id=#{mem_id}
	</update>
	<!-- 유저 삭제 -->
	<delete id="DeleteUser" parameterType="Member">
		DELETE FROM member where mem_id = #{mem_id}
	</delete>
	<!-- 등급상세보기 -->
	<select id="GetMembershipDetail" parameterType="Membership" resultType="Membership">
		SELECT * FROM membership WHERE membership_id=#{membership_id}
	</select>
	<update id="UpdateMembership" parameterType="Membership">
		UPDATE membership SET membership_name=#{membership_name}, membership_mile=#{membership_mile}, membership_discount=#{membership_discount} WHERE membership_id=#{membership_id}
	</update>
	<delete id="DeleteMembership" parameterType="Membership">
		DELETE FROM membership WHERE membership_id=#{membership_id}
	</delete>
	<insert id="InsertMembership" parameterType="Membership">
		INSERT INTO membership(membership_name,membership_mile,membership_discount) values(#{membership_name},#{membership_mile},#{membership_discount})
	</insert>
	
	<!-- ===================================================================================================================== -->
	<!-- 공지사항관련 -->
	<select id="GetNoticeList" resultType="Notice">
		SELECT * FROM notice order by notice_id desc
	</select>
	<select id="GetNoticeDetail" parameterType="java.lang.Integer" resultType="Notice">
		SELECT * FROM notice WHERE notice_id = #{notice_id}
	</select>
	<update id="UpdateNotice" parameterType="Notice">
		UPDATE notice SET notice_title=#{notice_title}, notice_content=#{notice_content} WHERE notice_id=#{notice_id}
	</update>
	<delete id="DeleteNotice" parameterType="Notice">
		DELETE FROM notice WHERE notice_id=#{notice_id}
	</delete>
	<insert id="InsertNotice" parameterType="Notice">
		INSERT INTO notice(notice_title, notice_content, notice_writer, notice_write_date) values(#{notice_title},#{notice_content},#{notice_writer},current_timestamp())
	</insert>
	<!-- ===================================================================================================================== -->
	<select id="GetTicketList" resultType="Ticket">
		SELECT * FROM ticket_detail
	</select>
	<select id="GetTicketDetail" parameterType="Ticket" resultType="Ticket">
		select td.*,ti.ticket_rep_img_path,ti.ticket_detail_img_path,c.city_id,c.city_name,co.country_name from ticket_detail td inner Join ticket_img ti on td.ticket_id = ti.ticket_id inner join city c on td.city_id = c.city_id inner join country co on c.country_id = co.country_id WHERE td.ticket_id=#{ticket_id}
	</select>
	<select id="GetCountryList" resultType="Ticket">
		SELECT * FROM country
	</select>
	<select id="GetCityList" resultType="Ticket">
		select * from city where country_id = (select country_id from country where country_id=(select country_id from country WHERE country_id=(select country_id from city where city_id=#{city_id})));
	</select>
	<select id="GetCityListChangeCountry" parameterType="Ticket" resultType="Ticket">
		SELECT * FROM city WHERE country_id=#{country_id}
	</select>
	<update id="UpdateTicket">
		UPDATE ticket_detail td, ticket_img ti SET td.city_id=#{city_id},td.ticket_name=#{ticket_name},td.ticket_sales_cnt=#{ticket_sales_cnt},td.ticket_location=#{ticket_location},td.ticket_score=#{ticket_score},td.ticket_due_date=#{ticket_due_date},td.ticket_adult_price=#{ticket_adult_price},td.ticket_child_price=#{ticket_child_price},ti.ticket_rep_img_path=#{ticket_rep_img_path},ti.ticket_detail_img_path=#{ticket_detail_img_path} WHERE td.ticket_id=#{ticket_id} AND ti.ticket_id=#{ticket_id}
	</update>
	<insert id="InsertTicket" parameterType="Ticket">
		INSERT INTO ticket_detail(ticket_id,city_id,ticket_name,ticket_sales_cnt,ticket_location,ticket_score,ticket_due_date,ticket_adult_price,ticket_child_price) values(#{ticket_id},#{city_id},#{ticket_name},0,#{ticket_location},0.00,CURRENT_TIMESTAMP(),#{ticket_adult_price},#{ticket_child_price});
		INSERT INTO ticket_img(ticket_id,ticket_rep_img_path,ticket_detail_img_path) values(#{ticket_id},#{ticket_rep_img_path},#{ticket_detail_img_path});
	</insert>
	<delete id="DeleteTicket" parameterType="Ticket">
		DELETE FROM ticket_detail WHERE ticket_id=#{ticket_id}
	</delete>
	
	
	
	
	
	
	
	<!-- ===================================================================================================================== -->
	<!-- 쿠폰관련 -->
	<select id="GetCouponList" resultType="Coupon">
		SELECT * FROM coupon
	</select>
	
	<select id="GetCouponDetail" parameterType="Coupon" resultType="Coupon">
		SELECT * FROM coupon WHERE coupon_id=#{coupon_id}
	</select>
	
	<select id="GetCouponMemberDetail" parameterType="Coupon" resultType="Coupon">
		SELECT m.* FROM coupon c, mem_coupon m WHERE c.coupon_id = m.coupon_id AND c.coupon_id=#{coupon_id}
	</select>
	<update id="UpdateCoupon" parameterType="Coupon">
		UPDATE coupon SET coupon_name=#{coupon_name}, coupon_discount=#{coupon_discount}, coupon_quantity=#{coupon_quantity} WHERE coupon_id=#{coupon_id}
	</update>
	<delete id="DeleteCoupon" parameterType="Coupon">
		DELETE FROM coupon WHERE coupon_id=#{coupon_id}
	</delete>
	<insert id="InsertCoupon" parameterType="Coupon">
		INSERT INTO coupon(coupon_name,coupon_discount,coupon_date,coupon_quantity) values(#{coupon_name},#{coupon_discount},current_timestamp(),#{coupon_quantity})
	</insert>
</mapper>